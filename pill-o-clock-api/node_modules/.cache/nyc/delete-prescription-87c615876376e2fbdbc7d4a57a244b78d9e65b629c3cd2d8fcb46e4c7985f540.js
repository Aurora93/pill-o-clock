function cov_1cd1bc1ncq(){var path="/Users/Au/bootcamp/collab/skylab-bootcamp-202001/staff/aurora-perez/pill-o-clock/pill-o-clock-api/logic/delete-prescription.js";var hash="0f5cb316eca19e842b95babead24314932a0c703";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/Au/bootcamp/collab/skylab-bootcamp-202001/staff/aurora-perez/pill-o-clock/pill-o-clock-api/logic/delete-prescription.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:50}},"1":{start:{line:2,column:46},end:{line:2,column:74}},"2":{start:{line:3,column:43},end:{line:3,column:73}},"3":{start:{line:5,column:0},end:{line:26,column:1}},"4":{start:{line:6,column:4},end:{line:6,column:29}},"5":{start:{line:7,column:4},end:{line:7,column:37}},"6":{start:{line:10,column:4},end:{line:25,column:24}},"7":{start:{line:12,column:12},end:{line:12,column:20}},"8":{start:{line:13,column:12},end:{line:13,column:82}},"9":{start:{line:13,column:23},end:{line:13,column:82}},"10":{start:{line:14,column:12},end:{line:14,column:78}},"11":{start:{line:14,column:23},end:{line:14,column:78}},"12":{start:{line:15,column:12},end:{line:15,column:100}},"13":{start:{line:15,column:28},end:{line:15,column:100}},"14":{start:{line:17,column:12},end:{line:22,column:13}},"15":{start:{line:17,column:25},end:{line:17,column:26}},"16":{start:{line:18,column:16},end:{line:18,column:24}},"17":{start:{line:19,column:16},end:{line:21,column:17}},"18":{start:{line:20,column:20},end:{line:20,column:182}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:5,column:17},end:{line:5,column:18}},loc:{start:{line:5,column:33},end:{line:26,column:1}},line:5},"1":{name:"(anonymous_1)",decl:{start:{line:11,column:14},end:{line:11,column:15}},loc:{start:{line:11,column:43},end:{line:23,column:9}},line:11},"2":{name:"(anonymous_2)",decl:{start:{line:25,column:14},end:{line:25,column:15}},loc:{start:{line:25,column:20},end:{line:25,column:23}},line:25}},branchMap:{"0":{loc:{start:{line:13,column:12},end:{line:13,column:82}},type:"if",locations:[{start:{line:13,column:12},end:{line:13,column:82}},{start:{line:13,column:12},end:{line:13,column:82}}],line:13},"1":{loc:{start:{line:14,column:12},end:{line:14,column:78}},type:"if",locations:[{start:{line:14,column:12},end:{line:14,column:78}},{start:{line:14,column:12},end:{line:14,column:78}}],line:14},"2":{loc:{start:{line:15,column:12},end:{line:15,column:100}},type:"if",locations:[{start:{line:15,column:12},end:{line:15,column:100}},{start:{line:15,column:12},end:{line:15,column:100}}],line:15},"3":{loc:{start:{line:19,column:16},end:{line:21,column:17}},type:"if",locations:[{start:{line:19,column:16},end:{line:21,column:17}},{start:{line:19,column:16},end:{line:21,column:17}}],line:19}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"0f5cb316eca19e842b95babead24314932a0c703"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_1cd1bc1ncq=function(){return actualCoverage;};return actualCoverage;}cov_1cd1bc1ncq();const{validate}=(cov_1cd1bc1ncq().s[0]++,require('pill-o-clock-utils'));const{models:{User,Drug,Guideline}}=(cov_1cd1bc1ncq().s[1]++,require('pill-o-clock-data'));const{NotFoundError,NotAllowedError}=(cov_1cd1bc1ncq().s[2]++,require('pill-o-clock-errors'));cov_1cd1bc1ncq().s[3]++;module.exports=(id,drugId)=>{cov_1cd1bc1ncq().f[0]++;cov_1cd1bc1ncq().s[4]++;validate.string(id,'id');cov_1cd1bc1ncq().s[5]++;validate.string(drugId,'drugId');cov_1cd1bc1ncq().s[6]++;return Promise.all([User.findById(id),Drug.findById(drugId),Guideline.findOne({prescribed:id,drug:drugId})]).then(([user,drug,prescript])=>{cov_1cd1bc1ncq().f[1]++;cov_1cd1bc1ncq().s[7]++;debugger;cov_1cd1bc1ncq().s[8]++;if(!drug){cov_1cd1bc1ncq().b[0][0]++;cov_1cd1bc1ncq().s[9]++;throw new NotFoundError(`drug with id ${drugId} not found`);}else{cov_1cd1bc1ncq().b[0][1]++;}cov_1cd1bc1ncq().s[10]++;if(!user){cov_1cd1bc1ncq().b[1][0]++;cov_1cd1bc1ncq().s[11]++;throw new NotFoundError(`user with id ${id} not found`);}else{cov_1cd1bc1ncq().b[1][1]++;}cov_1cd1bc1ncq().s[12]++;if(!prescript){cov_1cd1bc1ncq().b[2][0]++;cov_1cd1bc1ncq().s[13]++;throw new NotFoundError(`prescript within user with id ${id} not found`);}else{cov_1cd1bc1ncq().b[2][1]++;}cov_1cd1bc1ncq().s[14]++;for(let i=(cov_1cd1bc1ncq().s[15]++,0);i<user.prescription.length;i++){cov_1cd1bc1ncq().s[16]++;debugger;cov_1cd1bc1ncq().s[17]++;if(user.prescription[i].drug.toString()===drug._id.toString()){cov_1cd1bc1ncq().b[3][0]++;cov_1cd1bc1ncq().s[18]++;return Promise.all([User.findByIdAndUpdate(id,{$pull:{prescription:{_id:user.prescription[i]._id.toString()}}}),Guideline.findByIdAndRemove(prescript._id)]);}else{cov_1cd1bc1ncq().b[3][1]++;}}}).then(()=>{cov_1cd1bc1ncq().f[2]++;});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRlbGV0ZS1wcmVzY3JpcHRpb24uanMiXSwibmFtZXMiOlsidmFsaWRhdGUiLCJyZXF1aXJlIiwibW9kZWxzIiwiVXNlciIsIkRydWciLCJHdWlkZWxpbmUiLCJOb3RGb3VuZEVycm9yIiwiTm90QWxsb3dlZEVycm9yIiwibW9kdWxlIiwiZXhwb3J0cyIsImlkIiwiZHJ1Z0lkIiwic3RyaW5nIiwiUHJvbWlzZSIsImFsbCIsImZpbmRCeUlkIiwiZmluZE9uZSIsInByZXNjcmliZWQiLCJkcnVnIiwidGhlbiIsInVzZXIiLCJwcmVzY3JpcHQiLCJpIiwicHJlc2NyaXB0aW9uIiwibGVuZ3RoIiwidG9TdHJpbmciLCJfaWQiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIiRwdWxsIiwiZmluZEJ5SWRBbmRSZW1vdmUiXSwibWFwcGluZ3MiOiJpdUdBQUEsS0FBTSxDQUFFQSxRQUFGLDJCQUFlQyxPQUFPLENBQUMsb0JBQUQsQ0FBdEIsQ0FBTixDQUNBLEtBQU0sQ0FBRUMsTUFBTSxDQUFFLENBQUVDLElBQUYsQ0FBUUMsSUFBUixDQUFjQyxTQUFkLENBQVYsMkJBQXdDSixPQUFPLENBQUMsbUJBQUQsQ0FBL0MsQ0FBTixDQUNBLEtBQU0sQ0FBRUssYUFBRixDQUFpQkMsZUFBakIsMkJBQXFDTixPQUFPLENBQUMscUJBQUQsQ0FBNUMsQ0FBTixDLHdCQUVBTyxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FBQ0MsRUFBRCxDQUFLQyxNQUFMLEdBQWdCLGlEQUM3QlgsUUFBUSxDQUFDWSxNQUFULENBQWdCRixFQUFoQixDQUFvQixJQUFwQixFQUQ2Qix3QkFFN0JWLFFBQVEsQ0FBQ1ksTUFBVCxDQUFnQkQsTUFBaEIsQ0FBd0IsUUFBeEIsRUFGNkIsd0JBSzdCLE1BQU9FLENBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLENBQUNYLElBQUksQ0FBQ1ksUUFBTCxDQUFjTCxFQUFkLENBQUQsQ0FBb0JOLElBQUksQ0FBQ1csUUFBTCxDQUFjSixNQUFkLENBQXBCLENBQTJDTixTQUFTLENBQUNXLE9BQVYsQ0FBa0IsQ0FBQ0MsVUFBVSxDQUFFUCxFQUFiLENBQWlCUSxJQUFJLENBQUVQLE1BQXZCLENBQWxCLENBQTNDLENBQVosRUFDRlEsSUFERSxDQUNHLENBQUMsQ0FBQ0MsSUFBRCxDQUFPRixJQUFQLENBQWFHLFNBQWIsQ0FBRCxHQUE2QixpREFDL0IsU0FEK0Isd0JBRS9CLEdBQUksQ0FBQ0gsSUFBTCxDQUFXLHlEQUFNLElBQUlaLENBQUFBLGFBQUosQ0FBbUIsZ0JBQWVLLE1BQU8sWUFBekMsQ0FBTixDQUEyRCxDQUF0RSxpQ0FGK0IseUJBRy9CLEdBQUksQ0FBQ1MsSUFBTCxDQUFXLDBEQUFNLElBQUlkLENBQUFBLGFBQUosQ0FBbUIsZ0JBQWVJLEVBQUcsWUFBckMsQ0FBTixDQUF1RCxDQUFsRSxpQ0FIK0IseUJBSS9CLEdBQUksQ0FBQ1csU0FBTCxDQUFnQiwwREFBTSxJQUFJZixDQUFBQSxhQUFKLENBQW1CLGlDQUFnQ0ksRUFBRyxZQUF0RCxDQUFOLENBQXdFLENBQXhGLGlDQUorQix5QkFNL0IsSUFBSyxHQUFJWSxDQUFBQSxDQUFDLDJCQUFHLENBQUgsQ0FBVixDQUFnQkEsQ0FBQyxDQUFHRixJQUFJLENBQUNHLFlBQUwsQ0FBa0JDLE1BQXRDLENBQThDRixDQUFDLEVBQS9DLENBQW1ELDBCQUMvQyxTQUQrQyx5QkFFL0MsR0FBSUYsSUFBSSxDQUFDRyxZQUFMLENBQWtCRCxDQUFsQixFQUFxQkosSUFBckIsQ0FBMEJPLFFBQTFCLEtBQXlDUCxJQUFJLENBQUNRLEdBQUwsQ0FBU0QsUUFBVCxFQUE3QyxDQUFrRSxxREFDOUQsTUFBT1osQ0FBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksQ0FBQ1gsSUFBSSxDQUFDd0IsaUJBQUwsQ0FBdUJqQixFQUF2QixDQUEyQixDQUFDa0IsS0FBSyxDQUFFLENBQUNMLFlBQVksQ0FBRSxDQUFDRyxHQUFHLENBQUVOLElBQUksQ0FBQ0csWUFBTCxDQUFrQkQsQ0FBbEIsRUFBcUJJLEdBQXJCLENBQXlCRCxRQUF6QixFQUFOLENBQWYsQ0FBUixDQUEzQixDQUFELENBQWtHcEIsU0FBUyxDQUFDd0IsaUJBQVYsQ0FBNEJSLFNBQVMsQ0FBQ0ssR0FBdEMsQ0FBbEcsQ0FBWixDQUFQLENBQ0gsQ0FGRCxpQ0FHSCxDQUNKLENBYkUsRUFlRlAsSUFmRSxDQWVHLElBQU0seUJBQUcsQ0FmWixDQUFQLENBZ0JILENBckJEIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyB2YWxpZGF0ZSB9ID0gcmVxdWlyZSgncGlsbC1vLWNsb2NrLXV0aWxzJylcbmNvbnN0IHsgbW9kZWxzOiB7IFVzZXIsIERydWcsIEd1aWRlbGluZSB9IH0gPSByZXF1aXJlKCdwaWxsLW8tY2xvY2stZGF0YScpXG5jb25zdCB7IE5vdEZvdW5kRXJyb3IsIE5vdEFsbG93ZWRFcnJvciB9ID0gcmVxdWlyZSgncGlsbC1vLWNsb2NrLWVycm9ycycpXG5cbm1vZHVsZS5leHBvcnRzID0gKGlkLCBkcnVnSWQpID0+IHsgXG4gICAgdmFsaWRhdGUuc3RyaW5nKGlkLCAnaWQnKVxuICAgIHZhbGlkYXRlLnN0cmluZyhkcnVnSWQsICdkcnVnSWQnKVxuICAgIFxuICAgIFxuICAgIHJldHVybiBQcm9taXNlLmFsbChbVXNlci5maW5kQnlJZChpZCksIERydWcuZmluZEJ5SWQoZHJ1Z0lkKSwgR3VpZGVsaW5lLmZpbmRPbmUoe3ByZXNjcmliZWQ6IGlkLCBkcnVnOiBkcnVnSWR9KSBdKVxuICAgICAgICAudGhlbigoW3VzZXIsIGRydWcsIHByZXNjcmlwdF0pID0+IHtcbiAgICAgICAgICAgIGRlYnVnZ2VyXG4gICAgICAgICAgICBpZiAoIWRydWcpIHRocm93IG5ldyBOb3RGb3VuZEVycm9yKGBkcnVnIHdpdGggaWQgJHtkcnVnSWR9IG5vdCBmb3VuZGApXG4gICAgICAgICAgICBpZiAoIXVzZXIpIHRocm93IG5ldyBOb3RGb3VuZEVycm9yKGB1c2VyIHdpdGggaWQgJHtpZH0gbm90IGZvdW5kYClcbiAgICAgICAgICAgIGlmICghcHJlc2NyaXB0KSB0aHJvdyBuZXcgTm90Rm91bmRFcnJvcihgcHJlc2NyaXB0IHdpdGhpbiB1c2VyIHdpdGggaWQgJHtpZH0gbm90IGZvdW5kYClcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1c2VyLnByZXNjcmlwdGlvbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGRlYnVnZ2VyXG4gICAgICAgICAgICAgICAgaWYgKHVzZXIucHJlc2NyaXB0aW9uW2ldLmRydWcudG9TdHJpbmcoKSA9PT0gZHJ1Zy5faWQudG9TdHJpbmcoKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoW1VzZXIuZmluZEJ5SWRBbmRVcGRhdGUoaWQsIHskcHVsbDoge3ByZXNjcmlwdGlvbjoge19pZDogdXNlci5wcmVzY3JpcHRpb25baV0uX2lkLnRvU3RyaW5nKCl9fX0pLCBHdWlkZWxpbmUuZmluZEJ5SWRBbmRSZW1vdmUocHJlc2NyaXB0Ll9pZCkgXSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgICBcbiAgICAgICAgLnRoZW4oKCkgPT4geyB9KVxufSJdfQ==