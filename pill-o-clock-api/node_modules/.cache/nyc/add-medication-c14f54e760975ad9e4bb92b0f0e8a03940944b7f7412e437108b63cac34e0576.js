function cov_1ey645jkyx(){var path="/Users/Au/bootcamp/collab/skylab-bootcamp-202001/staff/aurora-perez/pill-o-clock/pill-o-clock-api/logic/add-medication.js";var hash="19c10bea40a5f7bdcb1a9add193c10000feb56c8";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/Au/bootcamp/collab/skylab-bootcamp-202001/staff/aurora-perez/pill-o-clock/pill-o-clock-api/logic/add-medication.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:50}},"1":{start:{line:2,column:35},end:{line:2,column:63}},"2":{start:{line:3,column:43},end:{line:3,column:73}},"3":{start:{line:17,column:0},end:{line:38,column:1}},"4":{start:{line:18,column:4},end:{line:18,column:29}},"5":{start:{line:19,column:4},end:{line:19,column:37}},"6":{start:{line:23,column:4},end:{line:37,column:24}},"7":{start:{line:25,column:12},end:{line:25,column:82}},"8":{start:{line:25,column:23},end:{line:25,column:82}},"9":{start:{line:26,column:12},end:{line:26,column:78}},"10":{start:{line:26,column:23},end:{line:26,column:78}},"11":{start:{line:27,column:12},end:{line:27,column:24}},"12":{start:{line:29,column:12},end:{line:31,column:14}},"13":{start:{line:30,column:16},end:{line:30,column:134}},"14":{start:{line:30,column:54},end:{line:30,column:134}},"15":{start:{line:33,column:12},end:{line:33,column:39}},"16":{start:{line:35,column:12},end:{line:35,column:31}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:17,column:17},end:{line:17,column:18}},loc:{start:{line:17,column:33},end:{line:38,column:1}},line:17},"1":{name:"(anonymous_1)",decl:{start:{line:24,column:14},end:{line:24,column:15}},loc:{start:{line:24,column:32},end:{line:36,column:9}},line:24},"2":{name:"(anonymous_2)",decl:{start:{line:29,column:37},end:{line:29,column:38}},loc:{start:{line:29,column:46},end:{line:31,column:13}},line:29},"3":{name:"(anonymous_3)",decl:{start:{line:37,column:14},end:{line:37,column:15}},loc:{start:{line:37,column:20},end:{line:37,column:23}},line:37}},branchMap:{"0":{loc:{start:{line:25,column:12},end:{line:25,column:82}},type:"if",locations:[{start:{line:25,column:12},end:{line:25,column:82}},{start:{line:25,column:12},end:{line:25,column:82}}],line:25},"1":{loc:{start:{line:26,column:12},end:{line:26,column:78}},type:"if",locations:[{start:{line:26,column:12},end:{line:26,column:78}},{start:{line:26,column:12},end:{line:26,column:78}}],line:26},"2":{loc:{start:{line:30,column:16},end:{line:30,column:134}},type:"if",locations:[{start:{line:30,column:16},end:{line:30,column:134}},{start:{line:30,column:16},end:{line:30,column:134}}],line:30}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"19c10bea40a5f7bdcb1a9add193c10000feb56c8"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_1ey645jkyx=function(){return actualCoverage;};return actualCoverage;}cov_1ey645jkyx();const{validate}=(cov_1ey645jkyx().s[0]++,require('pill-o-clock-utils'));const{models:{User,Drug}}=(cov_1ey645jkyx().s[1]++,require('pill-o-clock-data'));const{NotFoundError,NotAllowedError}=(cov_1ey645jkyx().s[2]++,require('pill-o-clock-errors'));/**
 * Add new medication to medication array
 * 
 * @param {string} id user's unique id
 * 
 * @param {string} drugId the id of the drug to add
 *
 * @returns {Promise<undefined>} an empty Promise on a successful addition
 * 
 * @throws {NotFoundError} if the user or drug does not exist
 */cov_1ey645jkyx().s[3]++;module.exports=(id,drugId)=>{cov_1ey645jkyx().f[0]++;cov_1ey645jkyx().s[4]++;validate.string(id,'id');cov_1ey645jkyx().s[5]++;validate.string(drugId,'drugId');let _user;cov_1ey645jkyx().s[6]++;return Promise.all([User.findById(id),Drug.findById(drugId)]).then(([user,drug])=>{cov_1ey645jkyx().f[1]++;cov_1ey645jkyx().s[7]++;if(!drug){cov_1ey645jkyx().b[0][0]++;cov_1ey645jkyx().s[8]++;throw new NotFoundError(`drug with id ${drugId} not found`);}else{cov_1ey645jkyx().b[0][1]++;}cov_1ey645jkyx().s[9]++;if(!user){cov_1ey645jkyx().b[1][0]++;cov_1ey645jkyx().s[10]++;throw new NotFoundError(`user with id ${id} not found`);}else{cov_1ey645jkyx().b[1][1]++;}cov_1ey645jkyx().s[11]++;_user=user;cov_1ey645jkyx().s[12]++;_user.medication.forEach(_drug=>{cov_1ey645jkyx().f[2]++;cov_1ey645jkyx().s[13]++;if(_drug.drugName===drug.drugName){cov_1ey645jkyx().b[2][0]++;cov_1ey645jkyx().s[14]++;throw new NotAllowedError(`user medication already have ${_drug.drugName} drug`);}else{cov_1ey645jkyx().b[2][1]++;}});cov_1ey645jkyx().s[15]++;_user.medication.push(drug);cov_1ey645jkyx().s[16]++;return _user.save();}).then(()=>{cov_1ey645jkyx().f[3]++;});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkZC1tZWRpY2F0aW9uLmpzIl0sIm5hbWVzIjpbInZhbGlkYXRlIiwicmVxdWlyZSIsIm1vZGVscyIsIlVzZXIiLCJEcnVnIiwiTm90Rm91bmRFcnJvciIsIk5vdEFsbG93ZWRFcnJvciIsIm1vZHVsZSIsImV4cG9ydHMiLCJpZCIsImRydWdJZCIsInN0cmluZyIsIl91c2VyIiwiUHJvbWlzZSIsImFsbCIsImZpbmRCeUlkIiwidGhlbiIsInVzZXIiLCJkcnVnIiwibWVkaWNhdGlvbiIsImZvckVhY2giLCJfZHJ1ZyIsImRydWdOYW1lIiwicHVzaCIsInNhdmUiXSwibWFwcGluZ3MiOiIyaUdBQUEsS0FBTSxDQUFFQSxRQUFGLDJCQUFlQyxPQUFPLENBQUMsb0JBQUQsQ0FBdEIsQ0FBTixDQUNBLEtBQU0sQ0FBRUMsTUFBTSxDQUFFLENBQUVDLElBQUYsQ0FBUUMsSUFBUixDQUFWLDJCQUE2QkgsT0FBTyxDQUFDLG1CQUFELENBQXBDLENBQU4sQ0FDQSxLQUFNLENBQUVJLGFBQUYsQ0FBaUJDLGVBQWpCLDJCQUFxQ0wsT0FBTyxDQUFDLHFCQUFELENBQTVDLENBQU4sQ0FFQTs7Ozs7Ozs7OzsyQkFZQU0sTUFBTSxDQUFDQyxPQUFQLENBQWlCLENBQUNDLEVBQUQsQ0FBS0MsTUFBTCxHQUFnQixpREFDN0JWLFFBQVEsQ0FBQ1csTUFBVCxDQUFnQkYsRUFBaEIsQ0FBb0IsSUFBcEIsRUFENkIsd0JBRTdCVCxRQUFRLENBQUNXLE1BQVQsQ0FBZ0JELE1BQWhCLENBQXdCLFFBQXhCLEVBRUEsR0FBSUUsQ0FBQUEsS0FBSixDQUo2Qix3QkFNN0IsTUFBT0MsQ0FBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVksQ0FBQ1gsSUFBSSxDQUFDWSxRQUFMLENBQWNOLEVBQWQsQ0FBRCxDQUFvQkwsSUFBSSxDQUFDVyxRQUFMLENBQWNMLE1BQWQsQ0FBcEIsQ0FBWixFQUNGTSxJQURFLENBQ0csQ0FBQyxDQUFDQyxJQUFELENBQU9DLElBQVAsQ0FBRCxHQUFrQixpREFDcEIsR0FBSSxDQUFDQSxJQUFMLENBQVcseURBQU0sSUFBSWIsQ0FBQUEsYUFBSixDQUFtQixnQkFBZUssTUFBTyxZQUF6QyxDQUFOLENBQTJELENBQXRFLGlDQURvQix3QkFFcEIsR0FBSSxDQUFDTyxJQUFMLENBQVcsMERBQU0sSUFBSVosQ0FBQUEsYUFBSixDQUFtQixnQkFBZUksRUFBRyxZQUFyQyxDQUFOLENBQXVELENBQWxFLGlDQUZvQix5QkFHcEJHLEtBQUssQ0FBR0ssSUFBUixDQUhvQix5QkFLcEJMLEtBQUssQ0FBQ08sVUFBTixDQUFpQkMsT0FBakIsQ0FBeUJDLEtBQUssRUFBSSxrREFDOUIsR0FBSUEsS0FBSyxDQUFDQyxRQUFOLEdBQW1CSixJQUFJLENBQUNJLFFBQTVCLENBQXNDLDBEQUFNLElBQUloQixDQUFBQSxlQUFKLENBQXFCLGdDQUErQmUsS0FBSyxDQUFDQyxRQUFTLE9BQW5FLENBQU4sQ0FBZ0YsQ0FBdEgsaUNBQ0gsQ0FGRCxFQUxvQix5QkFTcEJWLEtBQUssQ0FBQ08sVUFBTixDQUFpQkksSUFBakIsQ0FBc0JMLElBQXRCLEVBVG9CLHlCQVdwQixNQUFPTixDQUFBQSxLQUFLLENBQUNZLElBQU4sRUFBUCxDQUNILENBYkUsRUFjRlIsSUFkRSxDQWNHLElBQU0seUJBQUcsQ0FkWixDQUFQLENBZUgsQ0FyQkQiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IHZhbGlkYXRlIH0gPSByZXF1aXJlKCdwaWxsLW8tY2xvY2stdXRpbHMnKVxuY29uc3QgeyBtb2RlbHM6IHsgVXNlciwgRHJ1ZyB9IH0gPSByZXF1aXJlKCdwaWxsLW8tY2xvY2stZGF0YScpXG5jb25zdCB7IE5vdEZvdW5kRXJyb3IsIE5vdEFsbG93ZWRFcnJvciB9ID0gcmVxdWlyZSgncGlsbC1vLWNsb2NrLWVycm9ycycpXG5cbi8qKlxuICogQWRkIG5ldyBtZWRpY2F0aW9uIHRvIG1lZGljYXRpb24gYXJyYXlcbiAqIFxuICogQHBhcmFtIHtzdHJpbmd9IGlkIHVzZXIncyB1bmlxdWUgaWRcbiAqIFxuICogQHBhcmFtIHtzdHJpbmd9IGRydWdJZCB0aGUgaWQgb2YgdGhlIGRydWcgdG8gYWRkXG4gKlxuICogQHJldHVybnMge1Byb21pc2U8dW5kZWZpbmVkPn0gYW4gZW1wdHkgUHJvbWlzZSBvbiBhIHN1Y2Nlc3NmdWwgYWRkaXRpb25cbiAqIFxuICogQHRocm93cyB7Tm90Rm91bmRFcnJvcn0gaWYgdGhlIHVzZXIgb3IgZHJ1ZyBkb2VzIG5vdCBleGlzdFxuICovXG5cbm1vZHVsZS5leHBvcnRzID0gKGlkLCBkcnVnSWQpID0+IHsgXG4gICAgdmFsaWRhdGUuc3RyaW5nKGlkLCAnaWQnKVxuICAgIHZhbGlkYXRlLnN0cmluZyhkcnVnSWQsICdkcnVnSWQnKVxuXG4gICAgbGV0IF91c2VyXG5cbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW1VzZXIuZmluZEJ5SWQoaWQpLCBEcnVnLmZpbmRCeUlkKGRydWdJZCkgXSlcbiAgICAgICAgLnRoZW4oKFt1c2VyLCBkcnVnXSkgPT4ge1xuICAgICAgICAgICAgaWYgKCFkcnVnKSB0aHJvdyBuZXcgTm90Rm91bmRFcnJvcihgZHJ1ZyB3aXRoIGlkICR7ZHJ1Z0lkfSBub3QgZm91bmRgKVxuICAgICAgICAgICAgaWYgKCF1c2VyKSB0aHJvdyBuZXcgTm90Rm91bmRFcnJvcihgdXNlciB3aXRoIGlkICR7aWR9IG5vdCBmb3VuZGApXG4gICAgICAgICAgICBfdXNlciA9IHVzZXJcblxuICAgICAgICAgICAgX3VzZXIubWVkaWNhdGlvbi5mb3JFYWNoKF9kcnVnID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoX2RydWcuZHJ1Z05hbWUgPT09IGRydWcuZHJ1Z05hbWUpIHRocm93IG5ldyBOb3RBbGxvd2VkRXJyb3IoYHVzZXIgbWVkaWNhdGlvbiBhbHJlYWR5IGhhdmUgJHtfZHJ1Zy5kcnVnTmFtZX0gZHJ1Z2ApXG4gICAgICAgICAgICB9KVxuXG4gICAgICAgICAgICBfdXNlci5tZWRpY2F0aW9uLnB1c2goZHJ1ZylcblxuICAgICAgICAgICAgcmV0dXJuIF91c2VyLnNhdmUoKVxuICAgICAgICB9KVxuICAgICAgICAudGhlbigoKSA9PiB7IH0pXG59Il19