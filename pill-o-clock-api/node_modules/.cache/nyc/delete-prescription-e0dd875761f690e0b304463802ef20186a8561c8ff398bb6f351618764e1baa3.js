function cov_1cd1bc1ncq(){var path="/Users/Au/bootcamp/collab/skylab-bootcamp-202001/staff/aurora-perez/pill-o-clock/pill-o-clock-api/logic/delete-prescription.js";var hash="d0fd28352e0d94269a6e143fcca00837e89b74aa";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/Au/bootcamp/collab/skylab-bootcamp-202001/staff/aurora-perez/pill-o-clock/pill-o-clock-api/logic/delete-prescription.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:50}},"1":{start:{line:2,column:46},end:{line:2,column:74}},"2":{start:{line:3,column:43},end:{line:3,column:73}},"3":{start:{line:17,column:0},end:{line:38,column:1}},"4":{start:{line:18,column:4},end:{line:18,column:29}},"5":{start:{line:19,column:4},end:{line:19,column:37}},"6":{start:{line:22,column:4},end:{line:37,column:24}},"7":{start:{line:25,column:12},end:{line:25,column:82}},"8":{start:{line:25,column:23},end:{line:25,column:82}},"9":{start:{line:26,column:12},end:{line:26,column:78}},"10":{start:{line:26,column:23},end:{line:26,column:78}},"11":{start:{line:27,column:12},end:{line:27,column:100}},"12":{start:{line:27,column:28},end:{line:27,column:100}},"13":{start:{line:29,column:12},end:{line:34,column:13}},"14":{start:{line:29,column:25},end:{line:29,column:26}},"15":{start:{line:31,column:16},end:{line:33,column:17}},"16":{start:{line:32,column:20},end:{line:32,column:182}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:17,column:17},end:{line:17,column:18}},loc:{start:{line:17,column:33},end:{line:38,column:1}},line:17},"1":{name:"(anonymous_1)",decl:{start:{line:23,column:14},end:{line:23,column:15}},loc:{start:{line:23,column:43},end:{line:35,column:9}},line:23},"2":{name:"(anonymous_2)",decl:{start:{line:37,column:14},end:{line:37,column:15}},loc:{start:{line:37,column:20},end:{line:37,column:23}},line:37}},branchMap:{"0":{loc:{start:{line:25,column:12},end:{line:25,column:82}},type:"if",locations:[{start:{line:25,column:12},end:{line:25,column:82}},{start:{line:25,column:12},end:{line:25,column:82}}],line:25},"1":{loc:{start:{line:26,column:12},end:{line:26,column:78}},type:"if",locations:[{start:{line:26,column:12},end:{line:26,column:78}},{start:{line:26,column:12},end:{line:26,column:78}}],line:26},"2":{loc:{start:{line:27,column:12},end:{line:27,column:100}},type:"if",locations:[{start:{line:27,column:12},end:{line:27,column:100}},{start:{line:27,column:12},end:{line:27,column:100}}],line:27},"3":{loc:{start:{line:31,column:16},end:{line:33,column:17}},type:"if",locations:[{start:{line:31,column:16},end:{line:33,column:17}},{start:{line:31,column:16},end:{line:33,column:17}}],line:31}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0},f:{"0":0,"1":0,"2":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"d0fd28352e0d94269a6e143fcca00837e89b74aa"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_1cd1bc1ncq=function(){return actualCoverage;};return actualCoverage;}cov_1cd1bc1ncq();const{validate}=(cov_1cd1bc1ncq().s[0]++,require('pill-o-clock-utils'));const{models:{User,Drug,Guideline}}=(cov_1cd1bc1ncq().s[1]++,require('pill-o-clock-data'));const{NotFoundError,NotAllowedError}=(cov_1cd1bc1ncq().s[2]++,require('pill-o-clock-errors'));/**
 * Finds and delete a specific drug prescription from the user's prescriptions
 * 
 * @param {string} id user's unique id
 * 
 * @param {drugId} drugId drug's unique id, the drug that user want to delete of his/her prescription
 *
 * @returns {Promise<undefined>} an empty Promise on a successful deletion
 * 
 * @throws {NotFoundError} if the user, the drug or the prescription does not exist
 */cov_1cd1bc1ncq().s[3]++;module.exports=(id,drugId)=>{cov_1cd1bc1ncq().f[0]++;cov_1cd1bc1ncq().s[4]++;validate.string(id,'id');cov_1cd1bc1ncq().s[5]++;validate.string(drugId,'drugId');cov_1cd1bc1ncq().s[6]++;return Promise.all([User.findById(id),Drug.findById(drugId),Guideline.findOne({prescribed:id,drug:drugId})]).then(([user,drug,prescript])=>{cov_1cd1bc1ncq().f[1]++;cov_1cd1bc1ncq().s[7]++;if(!drug){cov_1cd1bc1ncq().b[0][0]++;cov_1cd1bc1ncq().s[8]++;throw new NotFoundError(`drug with id ${drugId} not found`);}else{cov_1cd1bc1ncq().b[0][1]++;}cov_1cd1bc1ncq().s[9]++;if(!user){cov_1cd1bc1ncq().b[1][0]++;cov_1cd1bc1ncq().s[10]++;throw new NotFoundError(`user with id ${id} not found`);}else{cov_1cd1bc1ncq().b[1][1]++;}cov_1cd1bc1ncq().s[11]++;if(!prescript){cov_1cd1bc1ncq().b[2][0]++;cov_1cd1bc1ncq().s[12]++;throw new NotFoundError(`prescript within user with id ${id} not found`);}else{cov_1cd1bc1ncq().b[2][1]++;}cov_1cd1bc1ncq().s[13]++;for(let i=(cov_1cd1bc1ncq().s[14]++,0);i<user.prescription.length;i++){cov_1cd1bc1ncq().s[15]++;if(user.prescription[i].drug.toString()===drug._id.toString()){cov_1cd1bc1ncq().b[3][0]++;cov_1cd1bc1ncq().s[16]++;return Promise.all([User.findByIdAndUpdate(id,{$pull:{prescription:{_id:user.prescription[i]._id.toString()}}}),Guideline.findByIdAndRemove(prescript._id)]);}else{cov_1cd1bc1ncq().b[3][1]++;}}}).then(()=>{cov_1cd1bc1ncq().f[2]++;});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRlbGV0ZS1wcmVzY3JpcHRpb24uanMiXSwibmFtZXMiOlsidmFsaWRhdGUiLCJyZXF1aXJlIiwibW9kZWxzIiwiVXNlciIsIkRydWciLCJHdWlkZWxpbmUiLCJOb3RGb3VuZEVycm9yIiwiTm90QWxsb3dlZEVycm9yIiwibW9kdWxlIiwiZXhwb3J0cyIsImlkIiwiZHJ1Z0lkIiwic3RyaW5nIiwiUHJvbWlzZSIsImFsbCIsImZpbmRCeUlkIiwiZmluZE9uZSIsInByZXNjcmliZWQiLCJkcnVnIiwidGhlbiIsInVzZXIiLCJwcmVzY3JpcHQiLCJpIiwicHJlc2NyaXB0aW9uIiwibGVuZ3RoIiwidG9TdHJpbmciLCJfaWQiLCJmaW5kQnlJZEFuZFVwZGF0ZSIsIiRwdWxsIiwiZmluZEJ5SWRBbmRSZW1vdmUiXSwibWFwcGluZ3MiOiIwbUdBQUEsS0FBTSxDQUFFQSxRQUFGLDJCQUFlQyxPQUFPLENBQUMsb0JBQUQsQ0FBdEIsQ0FBTixDQUNBLEtBQU0sQ0FBRUMsTUFBTSxDQUFFLENBQUVDLElBQUYsQ0FBUUMsSUFBUixDQUFjQyxTQUFkLENBQVYsMkJBQXdDSixPQUFPLENBQUMsbUJBQUQsQ0FBL0MsQ0FBTixDQUNBLEtBQU0sQ0FBRUssYUFBRixDQUFpQkMsZUFBakIsMkJBQXFDTixPQUFPLENBQUMscUJBQUQsQ0FBNUMsQ0FBTixDQUVBOzs7Ozs7Ozs7OzJCQVlBTyxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FBQ0MsRUFBRCxDQUFLQyxNQUFMLEdBQWdCLGlEQUM3QlgsUUFBUSxDQUFDWSxNQUFULENBQWdCRixFQUFoQixDQUFvQixJQUFwQixFQUQ2Qix3QkFFN0JWLFFBQVEsQ0FBQ1ksTUFBVCxDQUFnQkQsTUFBaEIsQ0FBd0IsUUFBeEIsRUFGNkIsd0JBSzdCLE1BQU9FLENBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLENBQUNYLElBQUksQ0FBQ1ksUUFBTCxDQUFjTCxFQUFkLENBQUQsQ0FBb0JOLElBQUksQ0FBQ1csUUFBTCxDQUFjSixNQUFkLENBQXBCLENBQTJDTixTQUFTLENBQUNXLE9BQVYsQ0FBa0IsQ0FBQ0MsVUFBVSxDQUFFUCxFQUFiLENBQWlCUSxJQUFJLENBQUVQLE1BQXZCLENBQWxCLENBQTNDLENBQVosRUFDRlEsSUFERSxDQUNHLENBQUMsQ0FBQ0MsSUFBRCxDQUFPRixJQUFQLENBQWFHLFNBQWIsQ0FBRCxHQUE2QixpREFFL0IsR0FBSSxDQUFDSCxJQUFMLENBQVcseURBQU0sSUFBSVosQ0FBQUEsYUFBSixDQUFtQixnQkFBZUssTUFBTyxZQUF6QyxDQUFOLENBQTJELENBQXRFLGlDQUYrQix3QkFHL0IsR0FBSSxDQUFDUyxJQUFMLENBQVcsMERBQU0sSUFBSWQsQ0FBQUEsYUFBSixDQUFtQixnQkFBZUksRUFBRyxZQUFyQyxDQUFOLENBQXVELENBQWxFLGlDQUgrQix5QkFJL0IsR0FBSSxDQUFDVyxTQUFMLENBQWdCLDBEQUFNLElBQUlmLENBQUFBLGFBQUosQ0FBbUIsaUNBQWdDSSxFQUFHLFlBQXRELENBQU4sQ0FBd0UsQ0FBeEYsaUNBSitCLHlCQU0vQixJQUFLLEdBQUlZLENBQUFBLENBQUMsMkJBQUcsQ0FBSCxDQUFWLENBQWdCQSxDQUFDLENBQUdGLElBQUksQ0FBQ0csWUFBTCxDQUFrQkMsTUFBdEMsQ0FBOENGLENBQUMsRUFBL0MsQ0FBbUQsMEJBRS9DLEdBQUlGLElBQUksQ0FBQ0csWUFBTCxDQUFrQkQsQ0FBbEIsRUFBcUJKLElBQXJCLENBQTBCTyxRQUExQixLQUF5Q1AsSUFBSSxDQUFDUSxHQUFMLENBQVNELFFBQVQsRUFBN0MsQ0FBa0UscURBQzlELE1BQU9aLENBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLENBQUNYLElBQUksQ0FBQ3dCLGlCQUFMLENBQXVCakIsRUFBdkIsQ0FBMkIsQ0FBQ2tCLEtBQUssQ0FBRSxDQUFDTCxZQUFZLENBQUUsQ0FBQ0csR0FBRyxDQUFFTixJQUFJLENBQUNHLFlBQUwsQ0FBa0JELENBQWxCLEVBQXFCSSxHQUFyQixDQUF5QkQsUUFBekIsRUFBTixDQUFmLENBQVIsQ0FBM0IsQ0FBRCxDQUFrR3BCLFNBQVMsQ0FBQ3dCLGlCQUFWLENBQTRCUixTQUFTLENBQUNLLEdBQXRDLENBQWxHLENBQVosQ0FBUCxDQUNILENBRkQsaUNBR0gsQ0FDSixDQWJFLEVBZUZQLElBZkUsQ0FlRyxJQUFNLHlCQUFHLENBZlosQ0FBUCxDQWdCSCxDQXJCRCIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHsgdmFsaWRhdGUgfSA9IHJlcXVpcmUoJ3BpbGwtby1jbG9jay11dGlscycpXG5jb25zdCB7IG1vZGVsczogeyBVc2VyLCBEcnVnLCBHdWlkZWxpbmUgfSB9ID0gcmVxdWlyZSgncGlsbC1vLWNsb2NrLWRhdGEnKVxuY29uc3QgeyBOb3RGb3VuZEVycm9yLCBOb3RBbGxvd2VkRXJyb3IgfSA9IHJlcXVpcmUoJ3BpbGwtby1jbG9jay1lcnJvcnMnKVxuXG4vKipcbiAqIEZpbmRzIGFuZCBkZWxldGUgYSBzcGVjaWZpYyBkcnVnIHByZXNjcmlwdGlvbiBmcm9tIHRoZSB1c2VyJ3MgcHJlc2NyaXB0aW9uc1xuICogXG4gKiBAcGFyYW0ge3N0cmluZ30gaWQgdXNlcidzIHVuaXF1ZSBpZFxuICogXG4gKiBAcGFyYW0ge2RydWdJZH0gZHJ1Z0lkIGRydWcncyB1bmlxdWUgaWQsIHRoZSBkcnVnIHRoYXQgdXNlciB3YW50IHRvIGRlbGV0ZSBvZiBoaXMvaGVyIHByZXNjcmlwdGlvblxuICpcbiAqIEByZXR1cm5zIHtQcm9taXNlPHVuZGVmaW5lZD59IGFuIGVtcHR5IFByb21pc2Ugb24gYSBzdWNjZXNzZnVsIGRlbGV0aW9uXG4gKiBcbiAqIEB0aHJvd3Mge05vdEZvdW5kRXJyb3J9IGlmIHRoZSB1c2VyLCB0aGUgZHJ1ZyBvciB0aGUgcHJlc2NyaXB0aW9uIGRvZXMgbm90IGV4aXN0XG4gKi9cblxubW9kdWxlLmV4cG9ydHMgPSAoaWQsIGRydWdJZCkgPT4geyBcbiAgICB2YWxpZGF0ZS5zdHJpbmcoaWQsICdpZCcpXG4gICAgdmFsaWRhdGUuc3RyaW5nKGRydWdJZCwgJ2RydWdJZCcpXG4gICAgXG4gICAgXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFtVc2VyLmZpbmRCeUlkKGlkKSwgRHJ1Zy5maW5kQnlJZChkcnVnSWQpLCBHdWlkZWxpbmUuZmluZE9uZSh7cHJlc2NyaWJlZDogaWQsIGRydWc6IGRydWdJZH0pIF0pXG4gICAgICAgIC50aGVuKChbdXNlciwgZHJ1ZywgcHJlc2NyaXB0XSkgPT4ge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoIWRydWcpIHRocm93IG5ldyBOb3RGb3VuZEVycm9yKGBkcnVnIHdpdGggaWQgJHtkcnVnSWR9IG5vdCBmb3VuZGApXG4gICAgICAgICAgICBpZiAoIXVzZXIpIHRocm93IG5ldyBOb3RGb3VuZEVycm9yKGB1c2VyIHdpdGggaWQgJHtpZH0gbm90IGZvdW5kYClcbiAgICAgICAgICAgIGlmICghcHJlc2NyaXB0KSB0aHJvdyBuZXcgTm90Rm91bmRFcnJvcihgcHJlc2NyaXB0IHdpdGhpbiB1c2VyIHdpdGggaWQgJHtpZH0gbm90IGZvdW5kYClcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1c2VyLnByZXNjcmlwdGlvbi5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmICh1c2VyLnByZXNjcmlwdGlvbltpXS5kcnVnLnRvU3RyaW5nKCkgPT09IGRydWcuX2lkLnRvU3RyaW5nKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFtVc2VyLmZpbmRCeUlkQW5kVXBkYXRlKGlkLCB7JHB1bGw6IHtwcmVzY3JpcHRpb246IHtfaWQ6IHVzZXIucHJlc2NyaXB0aW9uW2ldLl9pZC50b1N0cmluZygpfX19KSwgR3VpZGVsaW5lLmZpbmRCeUlkQW5kUmVtb3ZlKHByZXNjcmlwdC5faWQpIF0pXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgICAgXG4gICAgICAgIC50aGVuKCgpID0+IHsgfSlcbn0iXX0=