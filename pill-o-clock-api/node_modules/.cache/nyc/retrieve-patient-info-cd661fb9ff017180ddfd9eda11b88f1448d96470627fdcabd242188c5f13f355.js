function cov_5ej390err(){var path="/Users/Au/bootcamp/collab/skylab-bootcamp-202001/staff/aurora-perez/pill-o-clock/pill-o-clock-api/logic/retrieve-patient-info.js";var hash="744cd3c75d8ed8c473c6a0492a5639243b211727";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/Au/bootcamp/collab/skylab-bootcamp-202001/staff/aurora-perez/pill-o-clock/pill-o-clock-api/logic/retrieve-patient-info.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:50}},"1":{start:{line:2,column:29},end:{line:2,column:57}},"2":{start:{line:3,column:43},end:{line:3,column:73}},"3":{start:{line:5,column:0},end:{line:23,column:1}},"4":{start:{line:6,column:4},end:{line:6,column:29}},"5":{start:{line:7,column:4},end:{line:7,column:43}},"6":{start:{line:9,column:4},end:{line:21,column:10}},"7":{start:{line:12,column:12},end:{line:12,column:83}},"8":{start:{line:12,column:23},end:{line:12,column:83}},"9":{start:{line:13,column:12},end:{line:13,column:93}},"10":{start:{line:13,column:26},end:{line:13,column:93}},"11":{start:{line:15,column:12},end:{line:15,column:115}},"12":{start:{line:15,column:47},end:{line:15,column:115}},"13":{start:{line:17,column:12},end:{line:17,column:192}},"14":{start:{line:17,column:53},end:{line:17,column:85}},"15":{start:{line:17,column:104},end:{line:17,column:192}},"16":{start:{line:18,column:12},end:{line:18,column:188}},"17":{start:{line:18,column:56},end:{line:18,column:81}},"18":{start:{line:18,column:100},end:{line:18,column:188}},"19":{start:{line:20,column:12},end:{line:20,column:101}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:5,column:17},end:{line:5,column:18}},loc:{start:{line:5,column:36},end:{line:23,column:1}},line:5},"1":{name:"(anonymous_1)",decl:{start:{line:10,column:14},end:{line:10,column:15}},loc:{start:{line:10,column:35},end:{line:21,column:9}},line:10},"2":{name:"(anonymous_2)",decl:{start:{line:17,column:42},end:{line:17,column:43}},loc:{start:{line:17,column:53},end:{line:17,column:85}},line:17},"3":{name:"(anonymous_3)",decl:{start:{line:18,column:45},end:{line:18,column:46}},loc:{start:{line:18,column:56},end:{line:18,column:81}},line:18}},branchMap:{"0":{loc:{start:{line:12,column:12},end:{line:12,column:83}},type:"if",locations:[{start:{line:12,column:12},end:{line:12,column:83}},{start:{line:12,column:12},end:{line:12,column:83}}],line:12},"1":{loc:{start:{line:13,column:12},end:{line:13,column:93}},type:"if",locations:[{start:{line:13,column:12},end:{line:13,column:93}},{start:{line:13,column:12},end:{line:13,column:93}}],line:13},"2":{loc:{start:{line:15,column:12},end:{line:15,column:115}},type:"if",locations:[{start:{line:15,column:12},end:{line:15,column:115}},{start:{line:15,column:12},end:{line:15,column:115}}],line:15},"3":{loc:{start:{line:17,column:12},end:{line:17,column:192}},type:"if",locations:[{start:{line:17,column:12},end:{line:17,column:192}},{start:{line:17,column:12},end:{line:17,column:192}}],line:17},"4":{loc:{start:{line:18,column:12},end:{line:18,column:188}},type:"if",locations:[{start:{line:18,column:12},end:{line:18,column:188}},{start:{line:18,column:12},end:{line:18,column:188}}],line:18}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"744cd3c75d8ed8c473c6a0492a5639243b211727"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_5ej390err=function(){return actualCoverage;};return actualCoverage;}cov_5ej390err();const{validate}=(cov_5ej390err().s[0]++,require('pill-o-clock-utils'));const{models:{User}}=(cov_5ej390err().s[1]++,require('pill-o-clock-data'));const{NotFoundError,NotAllowedError}=(cov_5ej390err().s[2]++,require('pill-o-clock-errors'));cov_5ej390err().s[3]++;module.exports=(id,patientId)=>{cov_5ej390err().f[0]++;cov_5ej390err().s[4]++;validate.string(id,'id');cov_5ej390err().s[5]++;validate.string(patientId,'patientId');cov_5ej390err().s[6]++;return Promise.all([User.findById(id).lean(),User.findById(patientId).lean()]).then(([user,patient])=>{cov_5ej390err().f[1]++;cov_5ej390err().s[7]++;if(!user){cov_5ej390err().b[0][0]++;cov_5ej390err().s[8]++;throw new NotFoundError(`user with id ${id} does not exist`);}else{cov_5ej390err().b[0][1]++;}cov_5ej390err().s[9]++;if(!patient){cov_5ej390err().b[1][0]++;cov_5ej390err().s[10]++;throw new NotFoundError(`user with id ${patientId} does not exist`);}else{cov_5ej390err().b[1][1]++;}cov_5ej390err().s[11]++;if(!user.profile==='pharmacist'){cov_5ej390err().b[2][0]++;cov_5ej390err().s[12]++;throw new NotAllowedError(`user with id ${id} is not a pharmacist`);}else{cov_5ej390err().b[2][1]++;}cov_5ej390err().s[13]++;if(typeof user.contacts.find(contact=>{cov_5ej390err().f[2]++;cov_5ej390err().s[14]++;return contact.toString()===patientId;})==='undefined'){cov_5ej390err().b[3][0]++;cov_5ej390err().s[15]++;throw new NotFoundError(`user with id ${id} does not have contact with id ${patientId}`);}else{cov_5ej390err().b[3][1]++;}cov_5ej390err().s[16]++;if(typeof patient.contacts.find(contact=>{cov_5ej390err().f[3]++;cov_5ej390err().s[17]++;return contact.toString()===id;})==='undefined'){cov_5ej390err().b[4][0]++;cov_5ej390err().s[18]++;throw new NotFoundError(`user with id ${patientId} does not have contact with id ${id}`);}else{cov_5ej390err().b[4][1]++;}cov_5ej390err().s[19]++;return{progressRecordPatient:patient.progressRecord,progressPatient:patient.progress};});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJldHJpZXZlLXBhdGllbnQtaW5mby5qcyJdLCJuYW1lcyI6WyJ2YWxpZGF0ZSIsInJlcXVpcmUiLCJtb2RlbHMiLCJVc2VyIiwiTm90Rm91bmRFcnJvciIsIk5vdEFsbG93ZWRFcnJvciIsIm1vZHVsZSIsImV4cG9ydHMiLCJpZCIsInBhdGllbnRJZCIsInN0cmluZyIsIlByb21pc2UiLCJhbGwiLCJmaW5kQnlJZCIsImxlYW4iLCJ0aGVuIiwidXNlciIsInBhdGllbnQiLCJwcm9maWxlIiwiY29udGFjdHMiLCJmaW5kIiwiY29udGFjdCIsInRvU3RyaW5nIiwicHJvZ3Jlc3NSZWNvcmRQYXRpZW50IiwicHJvZ3Jlc3NSZWNvcmQiLCJwcm9ncmVzc1BhdGllbnQiLCJwcm9ncmVzcyJdLCJtYXBwaW5ncyI6InFwSEFBQSxLQUFNLENBQUVBLFFBQUYsMEJBQWVDLE9BQU8sQ0FBQyxvQkFBRCxDQUF0QixDQUFOLENBQ0EsS0FBTSxDQUFFQyxNQUFNLENBQUUsQ0FBRUMsSUFBRixDQUFWLDBCQUF1QkYsT0FBTyxDQUFDLG1CQUFELENBQTlCLENBQU4sQ0FDQSxLQUFNLENBQUVHLGFBQUYsQ0FBaUJDLGVBQWpCLDBCQUFxQ0osT0FBTyxDQUFDLHFCQUFELENBQTVDLENBQU4sQyx1QkFFQUssTUFBTSxDQUFDQyxPQUFQLENBQWlCLENBQUNDLEVBQUQsQ0FBS0MsU0FBTCxHQUFtQiwrQ0FDaENULFFBQVEsQ0FBQ1UsTUFBVCxDQUFnQkYsRUFBaEIsQ0FBb0IsSUFBcEIsRUFEZ0MsdUJBRWhDUixRQUFRLENBQUNVLE1BQVQsQ0FBZ0JELFNBQWhCLENBQTJCLFdBQTNCLEVBRmdDLHVCQUloQyxNQUFPRSxDQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxDQUFDVCxJQUFJLENBQUNVLFFBQUwsQ0FBY0wsRUFBZCxFQUFrQk0sSUFBbEIsRUFBRCxDQUEyQlgsSUFBSSxDQUFDVSxRQUFMLENBQWNKLFNBQWQsRUFBeUJLLElBQXpCLEVBQTNCLENBQVosRUFDRkMsSUFERSxDQUNHLENBQUMsQ0FBQ0MsSUFBRCxDQUFPQyxPQUFQLENBQUQsR0FBcUIsK0NBRXZCLEdBQUksQ0FBQ0QsSUFBTCxDQUFXLHVEQUFNLElBQUlaLENBQUFBLGFBQUosQ0FBbUIsZ0JBQWVJLEVBQUcsaUJBQXJDLENBQU4sQ0FBNEQsQ0FBdkUsZ0NBRnVCLHVCQUd2QixHQUFJLENBQUNTLE9BQUwsQ0FBYyx3REFBTSxJQUFJYixDQUFBQSxhQUFKLENBQW1CLGdCQUFlSyxTQUFVLGlCQUE1QyxDQUFOLENBQW1FLENBQWpGLGdDQUh1Qix3QkFLdkIsR0FBRyxDQUFDTyxJQUFJLENBQUNFLE9BQU4sR0FBa0IsWUFBckIsQ0FBbUMsd0RBQU0sSUFBSWIsQ0FBQUEsZUFBSixDQUFzQixnQkFBZUcsRUFBRyxzQkFBeEMsQ0FBTixDQUFvRSxDQUF2RyxnQ0FMdUIsd0JBT3ZCLEdBQUksTUFBT1EsQ0FBQUEsSUFBSSxDQUFDRyxRQUFMLENBQWNDLElBQWQsQ0FBbUJDLE9BQU8sRUFBSSxzREFBQUEsQ0FBQUEsT0FBTyxDQUFDQyxRQUFSLEtBQXVCYixTQUF2QixDQUFnQyxDQUE5RCxDQUFQLEdBQTJFLFdBQS9FLENBQTRGLHdEQUFNLElBQUlMLENBQUFBLGFBQUosQ0FBbUIsZ0JBQWVJLEVBQUcsa0NBQWlDQyxTQUFVLEVBQWhGLENBQU4sQ0FBd0YsQ0FBcEwsZ0NBUHVCLHdCQVF2QixHQUFJLE1BQU9RLENBQUFBLE9BQU8sQ0FBQ0UsUUFBUixDQUFpQkMsSUFBakIsQ0FBc0JDLE9BQU8sRUFBSSxzREFBQUEsQ0FBQUEsT0FBTyxDQUFDQyxRQUFSLEtBQXVCZCxFQUF2QixDQUF5QixDQUExRCxDQUFQLEdBQXVFLFdBQTNFLENBQXdGLHdEQUFNLElBQUlKLENBQUFBLGFBQUosQ0FBbUIsZ0JBQWVLLFNBQVUsa0NBQWlDRCxFQUFHLEVBQWhGLENBQU4sQ0FBd0YsQ0FBaEwsZ0NBUnVCLHdCQVV2QixNQUFPLENBQUNlLHFCQUFxQixDQUFFTixPQUFPLENBQUNPLGNBQWhDLENBQWdEQyxlQUFlLENBQUVSLE9BQU8sQ0FBQ1MsUUFBekUsQ0FBUCxDQUNILENBWkUsQ0FBUCxDQWNILENBbEJEIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyB2YWxpZGF0ZSB9ID0gcmVxdWlyZSgncGlsbC1vLWNsb2NrLXV0aWxzJylcbmNvbnN0IHsgbW9kZWxzOiB7IFVzZXIgfSB9ID0gcmVxdWlyZSgncGlsbC1vLWNsb2NrLWRhdGEnKVxuY29uc3QgeyBOb3RGb3VuZEVycm9yLCBOb3RBbGxvd2VkRXJyb3IgfSA9IHJlcXVpcmUoJ3BpbGwtby1jbG9jay1lcnJvcnMnKVxuXG5tb2R1bGUuZXhwb3J0cyA9IChpZCwgcGF0aWVudElkKSA9PiB7XG4gICAgdmFsaWRhdGUuc3RyaW5nKGlkLCAnaWQnKVxuICAgIHZhbGlkYXRlLnN0cmluZyhwYXRpZW50SWQsICdwYXRpZW50SWQnKVxuXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFtVc2VyLmZpbmRCeUlkKGlkKS5sZWFuKCksIFVzZXIuZmluZEJ5SWQocGF0aWVudElkKS5sZWFuKCkgXSlcbiAgICAgICAgLnRoZW4oKFt1c2VyLCBwYXRpZW50XSkgPT4ge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoIXVzZXIpIHRocm93IG5ldyBOb3RGb3VuZEVycm9yKGB1c2VyIHdpdGggaWQgJHtpZH0gZG9lcyBub3QgZXhpc3RgKVxuICAgICAgICAgICAgaWYgKCFwYXRpZW50KSB0aHJvdyBuZXcgTm90Rm91bmRFcnJvcihgdXNlciB3aXRoIGlkICR7cGF0aWVudElkfSBkb2VzIG5vdCBleGlzdGApXG5cbiAgICAgICAgICAgIGlmKCF1c2VyLnByb2ZpbGUgPT09ICdwaGFybWFjaXN0JykgdGhyb3cgbmV3IE5vdEFsbG93ZWRFcnJvciAoYHVzZXIgd2l0aCBpZCAke2lkfSBpcyBub3QgYSBwaGFybWFjaXN0YClcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiB1c2VyLmNvbnRhY3RzLmZpbmQoY29udGFjdCA9PiBjb250YWN0LnRvU3RyaW5nKCkgPT09IHBhdGllbnRJZCkgPT09ICd1bmRlZmluZWQnKSB0aHJvdyBuZXcgTm90Rm91bmRFcnJvcihgdXNlciB3aXRoIGlkICR7aWR9IGRvZXMgbm90IGhhdmUgY29udGFjdCB3aXRoIGlkICR7cGF0aWVudElkfWApXG4gICAgICAgICAgICBpZiAodHlwZW9mIHBhdGllbnQuY29udGFjdHMuZmluZChjb250YWN0ID0+IGNvbnRhY3QudG9TdHJpbmcoKSA9PT0gaWQpID09PSAndW5kZWZpbmVkJykgdGhyb3cgbmV3IE5vdEZvdW5kRXJyb3IoYHVzZXIgd2l0aCBpZCAke3BhdGllbnRJZH0gZG9lcyBub3QgaGF2ZSBjb250YWN0IHdpdGggaWQgJHtpZH1gKVxuXG4gICAgICAgICAgICByZXR1cm4ge3Byb2dyZXNzUmVjb3JkUGF0aWVudDogcGF0aWVudC5wcm9ncmVzc1JlY29yZCwgcHJvZ3Jlc3NQYXRpZW50OiBwYXRpZW50LnByb2dyZXNzfVxuICAgICAgICB9KVxuXG59XG4iXX0=