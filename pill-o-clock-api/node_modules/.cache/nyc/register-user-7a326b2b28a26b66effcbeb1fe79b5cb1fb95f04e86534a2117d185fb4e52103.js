function cov_12tm0a6jc3(){var path="/Users/Au/bootcamp/collab/skylab-bootcamp-202001/staff/aurora-perez/pill-o-clock/pill-o-clock-api/logic/register-user.js";var hash="6faa2f09a0299ac292f5a11ad81baea708b57f49";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/Au/bootcamp/collab/skylab-bootcamp-202001/staff/aurora-perez/pill-o-clock/pill-o-clock-api/logic/register-user.js",statementMap:{"0":{start:{line:1,column:21},end:{line:1,column:50}},"1":{start:{line:2,column:29},end:{line:2,column:57}},"2":{start:{line:3,column:28},end:{line:3,column:58}},"3":{start:{line:4,column:15},end:{line:4,column:34}},"4":{start:{line:24,column:0},end:{line:48,column:1}},"5":{start:{line:25,column:4},end:{line:25,column:33}},"6":{start:{line:26,column:4},end:{line:26,column:39}},"7":{start:{line:27,column:4},end:{line:27,column:37}},"8":{start:{line:28,column:4},end:{line:28,column:27}},"9":{start:{line:29,column:4},end:{line:29,column:37}},"10":{start:{line:30,column:4},end:{line:30,column:35}},"11":{start:{line:31,column:4},end:{line:31,column:39}},"12":{start:{line:32,column:4},end:{line:32,column:35}},"13":{start:{line:33,column:4},end:{line:33,column:25}},"14":{start:{line:34,column:4},end:{line:34,column:41}},"15":{start:{line:36,column:4},end:{line:47,column:24}},"16":{start:{line:38,column:12},end:{line:38,column:90}},"17":{start:{line:38,column:22},end:{line:38,column:90}},"18":{start:{line:40,column:12},end:{line:40,column:44}},"19":{start:{line:43,column:12},end:{line:43,column:111}},"20":{start:{line:45,column:12},end:{line:45,column:30}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:24,column:17},end:{line:24,column:18}},loc:{start:{line:24,column:82},end:{line:48,column:1}},line:24},"1":{name:"(anonymous_1)",decl:{start:{line:37,column:14},end:{line:37,column:15}},loc:{start:{line:37,column:22},end:{line:41,column:9}},line:37},"2":{name:"(anonymous_2)",decl:{start:{line:42,column:14},end:{line:42,column:15}},loc:{start:{line:42,column:26},end:{line:46,column:9}},line:42},"3":{name:"(anonymous_3)",decl:{start:{line:47,column:14},end:{line:47,column:15}},loc:{start:{line:47,column:20},end:{line:47,column:23}},line:47}},branchMap:{"0":{loc:{start:{line:38,column:12},end:{line:38,column:90}},type:"if",locations:[{start:{line:38,column:12},end:{line:38,column:90}},{start:{line:38,column:12},end:{line:38,column:90}}],line:38}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0},f:{"0":0,"1":0,"2":0,"3":0},b:{"0":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"6faa2f09a0299ac292f5a11ad81baea708b57f49"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];cov_12tm0a6jc3=function(){return actualCoverage;};return actualCoverage;}cov_12tm0a6jc3();const{validate}=(cov_12tm0a6jc3().s[0]++,require('pill-o-clock-utils'));const{models:{User}}=(cov_12tm0a6jc3().s[1]++,require('pill-o-clock-data'));const{NotAllowedError}=(cov_12tm0a6jc3().s[2]++,require('pill-o-clock-errors'));const bcrypt=(cov_12tm0a6jc3().s[3]++,require('bcryptjs'));/**
 * Registers a new user on the database
 * 
 * @param {string} name user's name
 * @param {string} surname user's surname
 * @param {string} email user's unique e-mail
 * @param {string} gender user's gender, with a three-choice
 * @param {number} age user's age
 * @param {number} phone user's phone number
 * @param {number} profile user's profile: patient or pharmacist
 * @param {number} email user's email
 * @param {string} password user's password, with further encryptation
 * 
 * @returns {Promise<string>} an empty Promise on a successful registration
 * 
 * @throws {NotAllowedError} if a user with that same email already exists on the database
 */cov_12tm0a6jc3().s[4]++;module.exports=(name,surname,gender,age,phone,profile,email,password)=>{cov_12tm0a6jc3().f[0]++;cov_12tm0a6jc3().s[5]++;validate.string(name,'name');cov_12tm0a6jc3().s[6]++;validate.string(surname,'surname');cov_12tm0a6jc3().s[7]++;validate.string(gender,'gender');cov_12tm0a6jc3().s[8]++;validate.gender(gender);cov_12tm0a6jc3().s[9]++;validate.type(age,'age',Number);cov_12tm0a6jc3().s[10]++;validate.string(phone,'phone');cov_12tm0a6jc3().s[11]++;validate.string(profile,'profile');cov_12tm0a6jc3().s[12]++;validate.string(email,'email');cov_12tm0a6jc3().s[13]++;validate.email(email);cov_12tm0a6jc3().s[14]++;validate.string(password,'password');cov_12tm0a6jc3().s[15]++;return User.findOne({email}).then(user=>{cov_12tm0a6jc3().f[1]++;cov_12tm0a6jc3().s[16]++;if(user){cov_12tm0a6jc3().b[0][0]++;cov_12tm0a6jc3().s[17]++;throw new NotAllowedError(`user with email ${email} already exists`);}else{cov_12tm0a6jc3().b[0][1]++;}cov_12tm0a6jc3().s[18]++;return bcrypt.hash(password,10);}).then(password=>{cov_12tm0a6jc3().f[2]++;cov_12tm0a6jc3().s[19]++;user=new User({name,surname,gender,age,phone,profile,email,password,created:new Date()});cov_12tm0a6jc3().s[20]++;return user.save();}).then(()=>{cov_12tm0a6jc3().f[3]++;});};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlZ2lzdGVyLXVzZXIuanMiXSwibmFtZXMiOlsidmFsaWRhdGUiLCJyZXF1aXJlIiwibW9kZWxzIiwiVXNlciIsIk5vdEFsbG93ZWRFcnJvciIsImJjcnlwdCIsIm1vZHVsZSIsImV4cG9ydHMiLCJuYW1lIiwic3VybmFtZSIsImdlbmRlciIsImFnZSIsInBob25lIiwicHJvZmlsZSIsImVtYWlsIiwicGFzc3dvcmQiLCJzdHJpbmciLCJ0eXBlIiwiTnVtYmVyIiwiZmluZE9uZSIsInRoZW4iLCJ1c2VyIiwiaGFzaCIsImNyZWF0ZWQiLCJEYXRlIiwic2F2ZSJdLCJtYXBwaW5ncyI6IjgzRkFBQSxLQUFNLENBQUVBLFFBQUYsMkJBQWVDLE9BQU8sQ0FBQyxvQkFBRCxDQUF0QixDQUFOLENBQ0EsS0FBTSxDQUFFQyxNQUFNLENBQUUsQ0FBRUMsSUFBRixDQUFWLDJCQUF1QkYsT0FBTyxDQUFDLG1CQUFELENBQTlCLENBQU4sQ0FDQSxLQUFNLENBQUVHLGVBQUYsMkJBQXNCSCxPQUFPLENBQUMscUJBQUQsQ0FBN0IsQ0FBTixDQUNBLEtBQU1JLENBQUFBLE1BQU0sMEJBQUdKLE9BQU8sQ0FBQyxVQUFELENBQVYsQ0FBWixDQUVBOzs7Ozs7Ozs7Ozs7Ozs7OzJCQWtCQUssTUFBTSxDQUFDQyxPQUFQLENBQWlCLENBQUNDLElBQUQsQ0FBT0MsT0FBUCxDQUFnQkMsTUFBaEIsQ0FBd0JDLEdBQXhCLENBQTZCQyxLQUE3QixDQUFvQ0MsT0FBcEMsQ0FBNkNDLEtBQTdDLENBQW9EQyxRQUFwRCxHQUFpRSxpREFDOUVmLFFBQVEsQ0FBQ2dCLE1BQVQsQ0FBZ0JSLElBQWhCLENBQXNCLE1BQXRCLEVBRDhFLHdCQUU5RVIsUUFBUSxDQUFDZ0IsTUFBVCxDQUFnQlAsT0FBaEIsQ0FBeUIsU0FBekIsRUFGOEUsd0JBRzlFVCxRQUFRLENBQUNnQixNQUFULENBQWdCTixNQUFoQixDQUF3QixRQUF4QixFQUg4RSx3QkFJOUVWLFFBQVEsQ0FBQ1UsTUFBVCxDQUFnQkEsTUFBaEIsRUFKOEUsd0JBSzlFVixRQUFRLENBQUNpQixJQUFULENBQWNOLEdBQWQsQ0FBbUIsS0FBbkIsQ0FBMEJPLE1BQTFCLEVBTDhFLHlCQU05RWxCLFFBQVEsQ0FBQ2dCLE1BQVQsQ0FBZ0JKLEtBQWhCLENBQXVCLE9BQXZCLEVBTjhFLHlCQU85RVosUUFBUSxDQUFDZ0IsTUFBVCxDQUFnQkgsT0FBaEIsQ0FBeUIsU0FBekIsRUFQOEUseUJBUTlFYixRQUFRLENBQUNnQixNQUFULENBQWdCRixLQUFoQixDQUF1QixPQUF2QixFQVI4RSx5QkFTOUVkLFFBQVEsQ0FBQ2MsS0FBVCxDQUFlQSxLQUFmLEVBVDhFLHlCQVU5RWQsUUFBUSxDQUFDZ0IsTUFBVCxDQUFnQkQsUUFBaEIsQ0FBMEIsVUFBMUIsRUFWOEUseUJBWTlFLE1BQU9aLENBQUFBLElBQUksQ0FBQ2dCLE9BQUwsQ0FBYSxDQUFFTCxLQUFGLENBQWIsRUFDRk0sSUFERSxDQUNHQyxJQUFJLEVBQUksa0RBQ1YsR0FBSUEsSUFBSixDQUFVLDBEQUFNLElBQUlqQixDQUFBQSxlQUFKLENBQXFCLG1CQUFrQlUsS0FBTSxpQkFBN0MsQ0FBTixDQUFvRSxDQUE5RSxpQ0FEVSx5QkFHVixNQUFPVCxDQUFBQSxNQUFNLENBQUNpQixJQUFQLENBQVlQLFFBQVosQ0FBc0IsRUFBdEIsQ0FBUCxDQUNILENBTEUsRUFNRkssSUFORSxDQU1HTCxRQUFRLEVBQUksa0RBQ2RNLElBQUksQ0FBRyxHQUFJbEIsQ0FBQUEsSUFBSixDQUFTLENBQUVLLElBQUYsQ0FBUUMsT0FBUixDQUFpQkMsTUFBakIsQ0FBeUJDLEdBQXpCLENBQThCQyxLQUE5QixDQUFxQ0MsT0FBckMsQ0FBOENDLEtBQTlDLENBQXFEQyxRQUFyRCxDQUErRFEsT0FBTyxDQUFFLEdBQUlDLENBQUFBLElBQUosRUFBeEUsQ0FBVCxDQUFQLENBRGMseUJBR2QsTUFBT0gsQ0FBQUEsSUFBSSxDQUFDSSxJQUFMLEVBQVAsQ0FDSCxDQVZFLEVBV0ZMLElBWEUsQ0FXRyxJQUFNLHlCQUFHLENBWFosQ0FBUCxDQVlILENBeEJEIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgeyB2YWxpZGF0ZSB9ID0gcmVxdWlyZSgncGlsbC1vLWNsb2NrLXV0aWxzJylcbmNvbnN0IHsgbW9kZWxzOiB7IFVzZXIgfSB9ID0gcmVxdWlyZSgncGlsbC1vLWNsb2NrLWRhdGEnKVxuY29uc3QgeyBOb3RBbGxvd2VkRXJyb3IgfSA9IHJlcXVpcmUoJ3BpbGwtby1jbG9jay1lcnJvcnMnKVxuY29uc3QgYmNyeXB0ID0gcmVxdWlyZSgnYmNyeXB0anMnKVxuXG4vKipcbiAqIFJlZ2lzdGVycyBhIG5ldyB1c2VyIG9uIHRoZSBkYXRhYmFzZVxuICogXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZSB1c2VyJ3MgbmFtZVxuICogQHBhcmFtIHtzdHJpbmd9IHN1cm5hbWUgdXNlcidzIHN1cm5hbWVcbiAqIEBwYXJhbSB7c3RyaW5nfSBlbWFpbCB1c2VyJ3MgdW5pcXVlIGUtbWFpbFxuICogQHBhcmFtIHtzdHJpbmd9IGdlbmRlciB1c2VyJ3MgZ2VuZGVyLCB3aXRoIGEgdGhyZWUtY2hvaWNlXG4gKiBAcGFyYW0ge251bWJlcn0gYWdlIHVzZXIncyBhZ2VcbiAqIEBwYXJhbSB7bnVtYmVyfSBwaG9uZSB1c2VyJ3MgcGhvbmUgbnVtYmVyXG4gKiBAcGFyYW0ge251bWJlcn0gcHJvZmlsZSB1c2VyJ3MgcHJvZmlsZTogcGF0aWVudCBvciBwaGFybWFjaXN0XG4gKiBAcGFyYW0ge251bWJlcn0gZW1haWwgdXNlcidzIGVtYWlsXG4gKiBAcGFyYW0ge3N0cmluZ30gcGFzc3dvcmQgdXNlcidzIHBhc3N3b3JkLCB3aXRoIGZ1cnRoZXIgZW5jcnlwdGF0aW9uXG4gKiBcbiAqIEByZXR1cm5zIHtQcm9taXNlPHN0cmluZz59IGFuIGVtcHR5IFByb21pc2Ugb24gYSBzdWNjZXNzZnVsIHJlZ2lzdHJhdGlvblxuICogXG4gKiBAdGhyb3dzIHtOb3RBbGxvd2VkRXJyb3J9IGlmIGEgdXNlciB3aXRoIHRoYXQgc2FtZSBlbWFpbCBhbHJlYWR5IGV4aXN0cyBvbiB0aGUgZGF0YWJhc2VcbiAqL1xuXG5tb2R1bGUuZXhwb3J0cyA9IChuYW1lLCBzdXJuYW1lLCBnZW5kZXIsIGFnZSwgcGhvbmUsIHByb2ZpbGUsIGVtYWlsLCBwYXNzd29yZCkgPT4ge1xuICAgIHZhbGlkYXRlLnN0cmluZyhuYW1lLCAnbmFtZScpXG4gICAgdmFsaWRhdGUuc3RyaW5nKHN1cm5hbWUsICdzdXJuYW1lJylcbiAgICB2YWxpZGF0ZS5zdHJpbmcoZ2VuZGVyLCAnZ2VuZGVyJylcbiAgICB2YWxpZGF0ZS5nZW5kZXIoZ2VuZGVyKVxuICAgIHZhbGlkYXRlLnR5cGUoYWdlLCAnYWdlJywgTnVtYmVyKVxuICAgIHZhbGlkYXRlLnN0cmluZyhwaG9uZSwgJ3Bob25lJylcbiAgICB2YWxpZGF0ZS5zdHJpbmcocHJvZmlsZSwgJ3Byb2ZpbGUnKVxuICAgIHZhbGlkYXRlLnN0cmluZyhlbWFpbCwgJ2VtYWlsJylcbiAgICB2YWxpZGF0ZS5lbWFpbChlbWFpbClcbiAgICB2YWxpZGF0ZS5zdHJpbmcocGFzc3dvcmQsICdwYXNzd29yZCcpXG5cbiAgICByZXR1cm4gVXNlci5maW5kT25lKHsgZW1haWwgfSlcbiAgICAgICAgLnRoZW4odXNlciA9PiB7XG4gICAgICAgICAgICBpZiAodXNlcikgdGhyb3cgbmV3IE5vdEFsbG93ZWRFcnJvcihgdXNlciB3aXRoIGVtYWlsICR7ZW1haWx9IGFscmVhZHkgZXhpc3RzYClcblxuICAgICAgICAgICAgcmV0dXJuIGJjcnlwdC5oYXNoKHBhc3N3b3JkLCAxMClcbiAgICAgICAgfSlcbiAgICAgICAgLnRoZW4ocGFzc3dvcmQgPT4ge1xuICAgICAgICAgICAgdXNlciA9IG5ldyBVc2VyKHsgbmFtZSwgc3VybmFtZSwgZ2VuZGVyLCBhZ2UsIHBob25lLCBwcm9maWxlLCBlbWFpbCwgcGFzc3dvcmQsIGNyZWF0ZWQ6IG5ldyBEYXRlIH0pXG5cbiAgICAgICAgICAgIHJldHVybiB1c2VyLnNhdmUoKVxuICAgICAgICB9KVxuICAgICAgICAudGhlbigoKSA9PiB7IH0pXG59Il19